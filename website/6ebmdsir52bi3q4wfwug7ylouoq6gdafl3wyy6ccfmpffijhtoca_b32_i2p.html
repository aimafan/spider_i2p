<html><head><link rel="preload" as="image" type="image/png" href="/static/logo_sm.png"><link rel="preload" as="font" type="font/woff2" href="/static/Mohave.woff2" crossorigin="anonymous"><link rel="preload" as="font" type="font/woff2" href="/static/Mohave-Italic.woff2" crossorigin="anonymous"><meta charset="utf-8"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="shortcut icon" href="/static/favicon.png"><title>HardenedBSD</title></head><body style="display:none;pointer-events:none" class="html front not-logged-in one-sidebar sidebar-first page-node site-name-hidden atr-7.x-3.x atv-7.x-3.0 site-name-hardenedbsd color-scheme-custom pixture-reloaded bs-l bb-n mb-dd mbp-l rc-8"><div id="skip-link" class="nocontent"><a href="#main-content" class="element-invisible element-focusable">Skip to main content</a></div><div class="texture-overlay"><div id="page" class="container page ssc-n ssw-n ssa-l sss-n btc-n btw-b bta-l bts-n ntc-n ntw-b nta-l nts-n ctc-n ctw-b cta-l cts-n ptc-n ptw-b pta-l pts-n"><header id="header" class="clearfix"><div class="header-inner clearfix"><div id="branding" class="branding-elements clearfix"><div id="logo"><a href="/" class="active"><img class="site-logo" typeof="foaf:Image" src="/static/logo_sm.png" alt=""></a></div><div id="name-and-slogan" class="element-invisible h-group"><h1 id="site-name" class="element-invisible"><a href="/" class="active">HardenedBSD</a></h1></div></div></div></header><div id="columns"><div class="columns-inner clearfix"><div id="content-column"><div class="content-inner"><div id="main-content"><div id="content"><div id="block-system-main" class="block block-system no-title odd first last block-count-1 block-region-content block-main"><article id="node-254" class="node node-article node-promoted node-sticky node-teaser article odd iat-n clearfix" about="/article/shawn-webb/2023-10-27/verifying-build-artifacts" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2023-10-27/verifying-build-artifacts" rel="bookmark">Verifying Build Artifacts</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>The HardenedBSD build artifacts are signed with an SSH key. SSH keys are used so that artifacts can be validated using only tools included in the base operating system.</p><p>First, download the SSH public key: </p><p><code><br>$ fetch https://installers.hardenedbsd.org/pub/keys/ssh.pub.txt<br></code></p><p>Then download the build artifact. For purposes of this documentation, the<br>compressed memstick installation image for HardenedBSD 14-STABLE will be used.</p><p><code><br>$ fetch https://installers.hardenedbsd.org/pub/14-stable/amd64/amd64/installer/LATEST/memstick.img.xz<br>$ fetch https://installers.hardenedbsd.org/pub/14-stable/amd64/amd64/installer/LATEST/memstick.img.xz.sig<br></code></p><p>Next, generate an `allowed_signers` file which contains the SSH public key: </p><p><code><br>$ echo "hbsd-os-build-01 $(cat ssh.pub.txt)" &gt; allowed_signers<br></code></p><p>Now the signature file can be verified:</p><p><code><br>$ ssh-keygen -Y verify -f allowed_signers -I hbsd-os-build-01 -n file -s memstick.img.xz.sig &lt; memstick.img.xz<br></code></p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2023-10-27/verifying-build-artifacts" rel="tag">Read more<span class="element-invisible"> about Verifying Build Artifacts</span></a></li></ul></nav></article><article id="node-50" class="node node-article node-promoted node-sticky node-teaser article even iat-n clearfix" about="/article/op/2015-11-03/hardenedbsd-stable-amd64-installers" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/op/2015-11-03/hardenedbsd-stable-amd64-installers" rel="bookmark">HardenedBSD installers</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><table width="100%"><tbody><tr><th>15-CURRENT</th><td><table><tbody><tr><th>git</th><td>git clone --single-branch --branch hardened/current/master <a href="https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git">https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git</a> hardenedbsd-current</td></tr><tr><th>installers</th><td><a href="https://installers.hardenedbsd.org/pub/current/">https://installers.hardenedbsd.org/pub/current/</a></td></tr></tbody></table></td></tr><tr><th>14-STABLE</th><td><table><tbody><tr><th>git</th><td>git clone --single-branch --branch hardened/14-stable/master <a href="https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git">https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git</a> hardenedbsd-14-stable</td></tr><tr><th>installers</th><td><a href="https://installers.hardenedbsd.org/pub/14-stable/">https://installers.hardenedbsd.org/pub/14-stable/</a></td></tr></tbody></table></td></tr><tr><th>13-STABLE</th><td><table><tbody><tr><th>git</th><td>git clone --single-branch --branch hardened/13-stable/master <a href="https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git">https://git.hardenedbsd.org/hardenedbsd/HardenedBSD.git</a> hardenedbsd-13-stable</td></tr><tr><th>installers</th><td><a href="https://installers.hardenedbsd.org/pub/13-stable/">https://installers.hardenedbsd.org/pub/13-stable/</a></td></tr></tbody></table></td></tr><tr><th>PORTS</th><td><table><tbody><tr><th>git</th><td>git clone --single-branch --branch hardenedbsd/main <a href="https://git.hardenedbsd.org/hardenedbsd/ports.git">https://git.hardenedbsd.org/hardenedbsd/ports.git</a> /usr/ports/</td></tr><tr><th>tar.gz</th><td>fetch -o hardenedbsd-ports.tar.gz '<a href="https://git.hardenedbsd.org/hardenedbsd/ports/-/archive/hardenedbsd/main/ports-hardenedbsd-main.tar.gz">https://git.hardenedbsd.org/hardenedbsd/ports/-/archive/hardenedbsd/main...</a>'</td></tr><tr><th>zip</th><td>fetch -o hardenedbsd-ports.zip '<a href="https://git.hardenedbsd.org/hardenedbsd/ports/-/archive/hardenedbsd/main/ports-hardenedbsd-main.zip">https://git.hardenedbsd.org/hardenedbsd/ports/-/archive/hardenedbsd/main...</a>'</td></tr></tbody></table></td></tr></tbody></table></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/op/2015-11-03/hardenedbsd-stable-amd64-installers" rel="tag">Read more<span class="element-invisible"> about HardenedBSD installers</span></a></li></ul></nav></article><article id="node-262" class="node node-article node-promoted node-teaser article odd iat-n clearfix" about="/article/shawn-webb/2024-03-31/hardenedbsd-march-2024-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-03-31/hardenedbsd-march-2024-status-report" rel="bookmark">HardenedBSD March 2024 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>What a busy month it has been! And not just for HardenedBSD, but for the rest of the security and IT industries as we work through the xz backdoor (CVE-2024-3094).</p><p>In src, the hbsdcontrol utility, and the library implementing the core logic (libhbsdcontrol) were rewritten from the ground up. While the implementation is now feature complete, there is still a bit of work to be done. Chiefly, rewriting the manual pages. After the documentation is updated, I plan to also integrate libucl support, to support JSON output and perhaps also support applying rules specified by a configuration file.</p><p>In ports, www/firefox was fixed and the minimum llvm version number was bumped for devel/boost.</p><p>Updates were applied across the entire infrastructure. A new build of hbsdfw (a HardenedBSD-basd fork of OPNsense) was deployed. This build has some issues, so I would recommend others not to deploy it, though it works fine enough for us to keep this current build deployed.</p><p>Here's what to look for in April:</p><ol><li>Continued work on {,lib}hbsdcontrol.</li><li>I'm hoping to study more the dance between the CSU, libc, libthr, and the RTLD.</li><li>More work on libhijack, perhaps a new shim library that gets injected to help aid further process injection work.</li></ol><p>And, lastly:</p><p><code><br>$ fetch -q -o - https://api.github.com/repos/HardenedBSD/HardenedBSD | jq -r .created_at<br>2014-04-08T10:10:24Z<br></code></p><p>Happy birthday, HardenedBSD! May the next decade be as impactful as the previous.</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-03-31/hardenedbsd-march-2024-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD March 2024 Status Report</span></a></li></ul></nav></article><article id="node-261" class="node node-article node-promoted node-teaser article even iat-n clearfix" about="/article/shawn-webb/2024-03-29/hardenedbsd-unaffected-cve-2024-3094-backdoor-xzlzma-560561" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-03-29/hardenedbsd-unaffected-cve-2024-3094-backdoor-xzlzma-560561" rel="bookmark">HardenedBSD Unaffected By CVE-2024-3094 (Backdoor in xz/lzma 5.6.0/5.6.1)</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>A backdoor targeting amd64 linux glibc based systems <a href="https://www.openwall.com/lists/oss-security/2024/03/29/4" target="_blank">was recently found</a> in the xz project. The versions of xz impacted are 5.6.0 and 5.6.1.</p><p>Neither FreeBSD nor HardenedBSD are directly affected by this issue. However, I suspect that those running an amd64 linux glibc jail on FreeBSD (or HardenedBSD) have the potential to be affected.</p><p>Note that the linux.ko and linux64.ko kernel modules are tagged as insecure/untrustworthy by default in HardenedBSD. Those wishing to deploy a Linux environment on HardenedBSD must explicitly enable the Linux syscall translation kernel modules (linux.ko and linux64.ko).</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-03-29/hardenedbsd-unaffected-cve-2024-3094-backdoor-xzlzma-560561" rel="tag">Read more<span class="element-invisible"> about HardenedBSD Unaffected By CVE-2024-3094 (Backdoor in xz/lzma 5.6.0/5.6.1)</span></a></li></ul></nav></article><article id="node-260" class="node node-article node-promoted node-teaser article odd iat-n clearfix" about="/article/shawn-webb/2024-03-01/hardenedbsd-february-2024-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-03-01/hardenedbsd-february-2024-status-report" rel="bookmark">HardenedBSD February 2024 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>I spent most of February getting 15-CURRENT working again. FreeBSD introduced a new library, libsys, which is where the userland side of performing syscalls is implemented. There's an intricate dance between libsys, libc, libthr, and the CSU. I spent some time learning about that dance, and I still feel like there's more to learn.</p><p>HardenedBSD 15-CURRENT is mostly fixed. Prior to the libsys change, we built libc with Link-Time Optimizations (LTO). Building libc with LTO was part of the problem, though not the only issue. Once all the issues are resolved, I will re-enable LTO for libc.</p><p>FreeBSD also introduced a new pam_xdg(8) PAM module. This module had a few vulnerabilities, which are fixed in HardenedBSD. The two NULL deref bugs are fixed in FreeBSD now, too. The filesystem race condition and recursion limit issues are somewhat mitigated in HardenedBSD, but not completely.</p><p>HardenedBSD now has two VisionFive StarFive2 64-bit RISCV SBCs. I spent a little bit of time toying around with them. The kernel boots to the mountroot prompt.I've been wanting to learn hardware hacking, including writing drivers, so these little SBCs might be great for that.</p><p><b>In ports:</b></p><ol><li>the u-boot ports are fixed</li><li>dns/unbound was updated to 1.19.1</li><li>the net/vnstat port was fixed</li><li>graphics/mupdf is now built as a PIE with SafeStack enabled</li><li>The secadm ports were updated</li></ol><p>Looking forward into March: I'm hoping to close two gaps of knowledge: the dance mentioned above and I'd like to return to jemalloc hardening. I plan to also do some infrastructure maintenance--routine updates.</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-03-01/hardenedbsd-february-2024-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD February 2024 Status Report</span></a></li></ul></nav></article><article id="node-259" class="node node-article node-promoted node-teaser article even iat-n clearfix" about="/article/shawn-webb/2024-01-31/hardenedbsd-january-2024-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-01-31/hardenedbsd-january-2024-status-report" rel="bookmark">HardenedBSD January 2024 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Happy new year! January saw a few changes in the src repository:</p><ol><li>Update some internal netlink(4) functions to use an unsigned integer for buffer size.</li><li>The NETLINK option is now effectively required by our upstream FreeBSD. I would encourage the community to study its code for potential issues.</li><li>The sysctl knobs vm.objects and vm.swap_objects are now only made available to privileged unjailed processes.</li><li>A new sysctl node is introduced that disables new USB device connections: hardening.pax.prohibit_new_usb. Possible values to set it to:<ul><li>0: disabled</li><li>1: enabled</li><li>2: enabled without possibility to disable without incurring a reboot</li></ul><p>It would be cool to see a new option: 3, enforce a USB device allowlist. I would like to delegate that to anyone who wants to volunteer to do that work. :-)</p></li></ol><p>In ports:</p><ol><li>An unneeded patch for dns/c-ares was remooved now that the port has been updated by upstream</li><li>Fix build of devel/ivykis</li><li>Bump default llvm ports version to 17</li></ol><p>In the infrastructure:</p><p>As detailed in this <a href="/article/shawn-webb/2024-01-17/change-build-cadence">announcement</a>, HardenedBSD will slow its OS/update build cadence from bi-weekly to monthly.</p><p>The issue plaguing <code>git clone https://...</code> of src or ports has been resolved!Major thanks to <a href="https://exquisite.social/@h3artbl33d" target="_blank">h3artbl33d</a> for helping resolve this issue.</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-01-31/hardenedbsd-january-2024-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD January 2024 Status Report</span></a></li></ul></nav></article><article id="node-258" class="node node-article node-promoted node-teaser article odd iat-n clearfix" about="/article/shawn-webb/2024-01-17/change-build-cadence" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-01-17/change-build-cadence" rel="bookmark">Change in Build Cadence</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Building packages takes quite a while, especially for 14-STABLE. The last package build for that branch took 371 hours, around 15-ish days. We currently build installer images and base OS updates every 14 days. This means that the 14-STABLE package builds will always be at least one build behind.</p><p>So, we need to slow the cadence of our installer image and base OS update builds. Instead of building installer images and base OS updates bi-weekly, we will move to monthly builds.</p><p>This will allow us to, at the start of every month, perform a clean package build. After that initial clean package build completes and is synced, we can then perform incremental package builds for the remainder of the month.</p><p>There are still a few potential issues with this. Sometimes, a port gets updated that 20,000+ other ports depend on, effectively meaning that we're doing a clean build even though an incremental build was requested.</p><p>If an incremental package build is unable to complete by the time the 1st day of the next month comes around, we will cancel that build in favor of starting the clean build on the 1st.</p><p>Slowing the frequency to monthly for the installers and base OS updates also opens up new opportunities for the community to explore. For example, we would welcome generation of .torrent files. Who knows, maybe we could help perform the initial seeding. :-)</p><p>These changes will take place on 01 Feb 2024.</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-01-17/change-build-cadence" rel="tag">Read more<span class="element-invisible"> about Change in Build Cadence</span></a></li></ul></nav></article><article id="node-257" class="node node-article node-promoted node-teaser article even iat-n clearfix" about="/article/shawn-webb/2024-01-01/hardenedbsd-december-2023-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2024-01-01/hardenedbsd-december-2023-status-report" rel="bookmark">HardenedBSD December 2023 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>Happy new year! In December, the focus was on finishing the move to our new home. Updates were applied across the entire infrastructure.</p><p>In src, we reverted commit 8cf35a2cbe0270666845a5f2634cfc50c90696f1, which had originally set the default umask to 027. This is a bit too strict to work in the real world as a default for HardenedBSD, so we chose to revert back to 022.</p><p>In ports, textproc/jq was updated to 1.7.1. CFI and SafeStack were enabled for textproc/jq. ports-mgmt/poudriere-hbsd was updated to 3.4.</p><p>The secadm project was brought up-to-date to account for recent VFS-related changes in FreeBSD. The ports entry was updated accordingly.</p><p>While not an official HardenedBSD project, libhijack has given inspiration to new hardening techniques. libhijack is a post-exploitation tool that can be used to inject arbitrary code and hook dynamically-loaded functions. It's a tool that I created with origins back to the early 2000's. libhijack can now inject shared objects over the ptrace boundary anonymously. For those curious, libhijack can be found here: <a href="https://github.com/SoldierX/libhijack">https://github.com/SoldierX/libhijack</a></p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2024-01-01/hardenedbsd-december-2023-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD December 2023 Status Report</span></a></li></ul></nav></article><article id="node-256" class="node node-article node-promoted node-teaser article odd iat-n clearfix" about="/article/shawn-webb/2023-12-01/hardenedbsd-november-2023-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2023-12-01/hardenedbsd-november-2023-status-report" rel="bookmark">HardenedBSD November 2023 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>The focus in November was navigating and closing the purchase of a new home.I worked a little bit on the change to jemalloc that will optionally return NULL for zero-sized allocation requests. I realized that I lack a lot of knowledge on how jemalloc works and I need to fill those gaps fully before landing this feature.</p><p>I worked a bit on Cross-DSO CFI, including working in the ports tree. I started toying around a little with applying CFI (via LLVM kCFI) to select kernel modules. Some work needs to happen in the kernel ELF linker to support newer relocation types ld.lld emits when linking with -fsanitize=kcfi.</p><p><b>In src:</b></p><ol><li>The vfs.zfs.bclone_enabled sysctl tunable is set to 0 by default. We hope to re-enable it after a long soak time in FreeBSD.</li><li>Generation of OpenSSH RSA host keys is disabled by default.</li></ol><p><b>In ports:</b></p><ol><li>Loic F fixed the lang/gcc11 and lang/gcc12 ports</li><li>Shawn Webb fixed the databases/postgresql*-server ports</li><li>Shawn Webb fixed dns/void-zones-tools</li><li>Shawn Webb added a new port: security/evilginx2</li></ol><p><b>IMPORTANT INFRASTRUCTURE NOTE:</b></p><p>I'm hoping to move the HardenedBSD development/build infrastructure over to the new house as soon as this weekend. Electrical work still needs to happen, but I might have a workaround available until a proper solution is in place.</p><p>If the move does not happen this weekend (02-03 Dec 2023), then it will definitely happen the following weekend.</p><p><b>Other projects:</b></p><p>While writing this very status report, I've kicked off another build of hbsdfw.This includes the latest ZFS changes from upstream and more OpenSSL fixes. I'm hoping to have it tested and uploaded this weekend.</p><p>Once I have the jemalloc feature sorted out, I plan to resume work on libhijack.I've been letting my brain think about what needs to happen next over the past few months. Implementing an RTLD over the PTrace boundary is a bit more difficult than one might think. :-)</p><p>I've also started writing a little HardenedBSD testing framework. This will help us identify and resolve regressions (like the PaX NOEXEC regression I still have yet to fully resolve.)</p><p>If you would like to help with HardenedBSD development, but aren't sure where to start, there's this nifty issue board that shows all the bugs, features, and other work we would like help with: <a href="https://git.hardenedbsd.org/groups/hardenedbsd/-/boards/11">https://git.hardenedbsd.org/groups/hardenedbsd/-/boards/11</a></p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2023-12-01/hardenedbsd-november-2023-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD November 2023 Status Report</span></a></li></ul></nav></article><article id="node-255" class="node node-article node-promoted node-teaser article even iat-n clearfix" about="/article/shawn-webb/2023-11-06/hardenedbsd-october-2023-status-report" typeof="sioc:Item foaf:Document"><header class="node-header"><h1 class="node-title"><a href="/article/shawn-webb/2023-11-06/hardenedbsd-october-2023-status-report" rel="bookmark">HardenedBSD October 2023 Status Report</a></h1></header><div class="node-content"><div class="field field-name-body field-type-text-with-summary field-label-hidden view-mode-teaser"><div class="field-items"><div class="field-item even" property="content:encoded"><p>This status is going to be pretty short. The focus in October has been on the home purchase.</p><p>News regarding the home purchase: if things go according to plan, we will take possession of the property towards the end of November 2023 (this month).</p><p><b>In ports:</b></p><ol><li>Loic F fixed archivers/rpm4</li><li>Loic F fixed graphics/sane-backends</li><li>Shawn Webb fixed lang/perl5.36</li><li>Shawn Webb updated ports-mgmt/pkg to 1.20.8</li><li>Shawn Webb "fixed" audio/pulseaudio by ripping out SIMD support. A more proper fix is needed. If the community can help us re-gain SIMD support for this port, that would be very much appreciated.</li></ol><p>I worked on hbsdfw a little bit, figured out some of the issues in building the base OS packages. Now I need to figure out why some ports fail to build.</p><p>For November, I'm working on a new malloc.conf(5) option: bool nullonzero, default: false. This malloc.conf(5) option will cause malloc(3)-and-friends to return NULL when a zero size is passed in. This would prevent a class of integer overflow vulnerabilities that can lead to buffer overflows.</p><p>For example, in the common OpenSolaris CTF code (used in DTrace), we find the following function:</p><pre>char *xstrndup(char *str, size_t len){char *newstr;/* * HardenedBSD note: * * If len happens to be SIZE_MAX, the size passed to malloc is zero. */if ((newstr = malloc(len + 1)) == NULL)memory_bailout();/* *HardenedBSD note: * * malloc(0) happily handed us a non-NULL pointer, sized zero. We now * copy SIZE_MAX bytes from str to newstr. */(void) strncpy(newstr, str, len);newstr[len] = '\0';return (newstr);}</pre><p>HardenedBSD would prefer developers get used to providing reasonableness checks regarding size calculations. This xstrndup function could include this defensive coding technique of applying reasonable checks like so:</p><pre>char *xstrndup(char *str, size_t len){char *newstr;if (str == NULL || len + 1 == 0) {return (NULL);}if (len == 0 &amp;&amp; str[0] != '\0') {return (NULL);}/* * If len is still 0, that means we're duplicating an empty string. * That's fine, since strdup("") is a thing. */if ((newstr = malloc(len + 1)) == NULL)memory_bailout();(void) strncpy(newstr, str, len);newstr[len] = '\0';return (newstr);}</pre><p>These new reasonable checks ensure that sleepy, caffeine-deprived developers have a harder time making understandable mistakes. We want to encourage safe and defensive programming techniques, especially before we launch this feature. I will fix the issues that come up in the base OS. When it lands, this feature will be defaulted to disabled, but the reasonableness checks and fixes will remain in place regardless.</p><p>So that's a preview of what's going on. I hope to land this before the end of the month. Perhaps mid-2024 we'll have it enabled by default.</p></div></div></div></div><nav class="clearfix"><ul class="links inline"><li class="node-readmore first last"><a href="/article/shawn-webb/2023-11-06/hardenedbsd-october-2023-status-report" rel="tag">Read more<span class="element-invisible"> about HardenedBSD October 2023 Status Report</span></a></li></ul></nav></article><h2 class="element-invisible">Pages</h2><div class="item-list item-list-pager"><ul class="pager"><li class="pager-current even first">1</li><li class="pager-item odd"><a href="/node?page=1">2</a></li><li class="pager-item even"><a href="/node?page=2">3</a></li><li class="pager-item odd"><a href="/node?page=3">4</a></li><li class="pager-item even"><a href="/node?page=4">5</a></li><li class="pager-item odd"><a href="/node?page=5">6</a></li><li class="pager-item even"><a href="/node?page=6">7</a></li><li class="pager-item odd"><a href="/node?page=7">8</a></li><li class="pager-item even"><a href="/node?page=8">9</a></li><li class="pager-ellipsis odd">…</li><li class="pager-next even"><a href="/node?page=1">next ›</a></li><li class="pager-last odd last"><a href="/node?page=24">last »</a></li></ul></div></div></div><a href="/rss.xml" class="feed-icon"><img typeof="foaf:Image" class="image-style-none" src="/misc/feed.png" width="16" height="16" alt=""></a></div></div></div><div class="region region-sidebar-first sidebar"><div class="region-inner clearfix"><section id="block-block-6" class="block block-block odd first block-count-2 block-region-sidebar-first block-6"><div class="block-inner clearfix"><h2 class="block-title">Donate to HardenedBSD</h2><div class="block-content content"><div><p><a href="https://github.com/sponsors/lattera/" target="_blank">GitHub Sponsors</a></p><p>BTC:<br>1FmbSRvZK4yC1b6aj<br>eZWSvYXV2nmvwdWQq</p><p>BCH:<br>1PbGHPPmdNqSmh4L<br>3SbvPdaPzSL9kZ5H6f</p><p>ETH:<br>0x9Ea8E44736AC8Ed<br>806ef57f7F174a14D93689775</p><p>LTC:<br>LQsiWawAU9saQi4mK<br>AyW8LBY97WXaTPi9m</p></div></div></div></section><section id="block-block-8" class="block block-block even block-count-3 block-region-sidebar-first block-8"><div class="block-inner clearfix"><h2 class="block-title">2021 Donation Status</h2><div class="block-content content"><div><a href="/content/donors"><br><progress value="15000" max="15000"></progress></a><br>Contributions raised: $19,369.02 out of target of $15,000 USD.</div></div></div></section><nav id="block-menu-menu-pages" class="block block-menu odd block-count-4 block-region-sidebar-first block-menu-pages"><div class="block-inner clearfix"><h2 class="block-title">Navigation</h2><div class="block-content content"><ul class="menu clearfix"><li class="first leaf menu-depth-1 menu-item-218"><a href="/" class="active">Home</a></li><li class="leaf menu-depth-1 menu-item-318"><a href="/content/about">About HardenedBSD</a></li><li class="leaf menu-depth-1 menu-item-330"><a href="https://installers.hardenedbsd.org/pub">Latest Builds</a></li><li class="leaf menu-depth-1 menu-item-1107"><a href="/content/hardenedbsd-infrastructure">Project Infrastructure</a></li><li class="leaf menu-depth-1 menu-item-938"><a href="/content/mirrors">Mirrors</a></li><li class="leaf menu-depth-1 menu-item-767"><a href="/content/easy-feature-comparison">Feature Comparisons</a></li><li class="leaf menu-depth-1 menu-item-385"><a href="/content/donors">Donors</a></li><li class="leaf menu-depth-1 menu-item-620"><a href="https://git.hardenedbsd.org/hardenedbsd/HardenedBSD/-/wikis/home">HardenedBSD Wiki</a></li><li class="leaf menu-depth-1 menu-item-340"><a href="/content/mailing-lists">Mailing Lists</a></li><li class="leaf menu-depth-1 menu-item-764"><a href="/content/roadmap">Roadmap</a></li><li class="leaf menu-depth-1 menu-item-319"><a href="/content/hardenedbsd-team">Meet The Team</a></li><li class="leaf menu-depth-1 menu-item-320"><a href="/content/projects">Projects</a></li><li class="last leaf menu-depth-1 menu-item-619"><a href="/in_media">In media</a></li></ul></div></div></nav><div id="block-search-form" class="block block-search no-title even block-count-5 block-region-sidebar-first block-form"><div class="block-inner clearfix"><div class="block-content content"><form action="http://hardenedbsd.i2p/" method="get" id="search-block-form" accept-charset="UTF-8"><div><div class="container-inline"><h2 class="element-invisible">Search form</h2><div class="form-item form-type-textfield form-item-search-block-form"><label class="element-invisible" for="edit-search-block-form--2">Search </label><input type="search" id="edit-search-block-form--2" name="search_block_form" value="" size="15" maxlength="128" class="form-text"></div><div class="form-actions form-wrapper" id="edit-actions"><input type="submit" id="edit-submit" name="op" value="Search" class="form-submit"></div><input type="hidden" name="form_build_id" value="form-Q-_RxNQ7pcRpf3p96GA4SxjQ5wKYQIJR-AsnMXdXYls"><input type="hidden" name="form_id" value="search_block_form"></div></div></form></div></div></div><section id="block-block-1" class="block block-block odd block-count-6 block-region-sidebar-first block-1"><div class="block-inner clearfix"><h2 class="block-title">Links</h2><div class="block-content content"><p><a href="https://github.com/HardenedBSD" target="_blank">HardenedBSD at GitHub</a><br><a href="https://gitlab.com/groups/HardenedBSD" target="_blank">HardenedBSD at GitLab</a><br><a href="https://www.twitter.com/HardenedBSD" target="_blank">HardenedBSD on Twitter</a><br><a href="https://bsd.network/@HardenedBSD" target="_blank">HardenedBSD on Mastodon</a><br><a href="https://forum.defcon.org/node/240318" target="_blank">HardenedBSD on DefCon Forums</a><br><a href="https://matrix.to/#/#hardenedbsd:matrix.org" target="_blank">HardenedBSD on Matrix</a><br>#hardenedbsd at Libera IRC</p></div></div></section><div id="block-block-4" class="block block-block no-title even block-count-7 block-region-sidebar-first block-4"><div class="block-inner clearfix"><div class="block-content content"><p><a href="https://www.rootbsd.net/" target="_blank"><img border="0" src="/img/rootbsd_badge.png"></a></p></div></div></div><div id="block-block-12" class="block block-block no-title odd block-count-8 block-region-sidebar-first block-12"><div class="block-inner clearfix"><div class="block-content content"><div><a href="https://www.defcon.org/" target="_blank"><img border="0" src="/static/defcon.png"></a></div></div></div></div><div id="block-block-10" class="block block-block no-title even block-count-9 block-region-sidebar-first block-10"><div class="block-inner clearfix"><div class="block-content content"><div><a href="https://www.nyi.net/" target="_blank"><img border="0" src="/static/nyi.png"></a></div></div></div></div><div id="block-block-11" class="block block-block no-title odd block-count-10 block-region-sidebar-first block-11"><div class="block-inner clearfix"><div class="block-content content"><div><a href="https://opnsense.org/" target="_blank"><img border="0" src="/~shawn/opnsense.png"></a></div></div></div></div><div id="block-block-5" class="block block-block no-title even last block-count-11 block-region-sidebar-first block-5"><div class="block-inner clearfix"><div class="block-content content"><div><a href="https://www.soldierx.com/" target="_blank"><img border="0" src="/static/soldierx.png"></a></div></div></div></div></div></div></div></div></div></div><link rel="stylesheet" href="/static/hbsd.css" type="text/css"></body></html>